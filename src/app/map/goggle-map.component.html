<div class="container-fluid" *ngIf="rigs">
  <button type="button" class="navbar-toggler mt-1 mb-1" (click)="isCollapsed = !isCollapsed" [attr.aria-expanded]="!isCollapsed"
          aria-controls="collapseExample"><i class="fas fa-bars"></i></button>
  <div class="row" id="row">
    <div class="card col-md-3 col-sm-12" [ngbCollapse]="isCollapsed">
      <div class="card-body">
        <label>Search for a rig:</label>
        <input [(ngModel)]="input" placeholder="Name or IMO..." class="form-control col-auto"/>
        <small class="form-text text-muted mb-2">Search for a phrase in the rig's name or the IMO</small>
        <div class="card-deck" style="max-height: 625px">
          <div class="card-text" style="overflow-y: scroll; min-width: 100%;">
            <div class="card" *ngFor="let rig of rigs | filterRigs: input">
              <div class="card-body">
                <div class="row">
                  <div class="col">
                    <h6 class="card-text">{{rig.name}}<br>{{rig.imo}}</h6>
                  </div>
                  <div class="col">
                    <button class="btn btn-secondary float-right" (click)="showMarkerOnMap(rig)">Locate</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col">
      <agm-map id="map" (mapReady)="mapReady($event)" [latitude]="latitude" [longitude]="longitude" [zoom]="zoom" [mapTypeControl]="true" [mapTypeId]="'hybrid'">
        <agm-marker-cluster
          imagePath="https://raw.githubusercontent.com/googlemaps/v3-utility-library/master/markerclustererplus/images/m"
          [minimumClusterSize]="4">

          <agm-marker
            *ngFor="let rig of rigs"
            (markerClick)="clickedMarker(openedWindow, rig)"
            [title]="'IMO: ' + rig.imo + ' | Name:' + ' ' + rig.name"
            [latitude]="rig.locations[0].latitude"
            [longitude]="rig.locations[0].longitude"
            [label]="{fontWeight: 'bold', text: rig.label, color: 'yellow'}"
            [iconUrl]="'assets/rig-icon.png'">

            <agm-info-window [isOpen]="isInfoWindowOpen(rig.imo)">
              <div>
                <h3 class="card-title">{{rig.name}}</h3>
                <div class="card-body">
                  <p class="card-text"><strong>IMO: {{rig.imo}}</strong></p>
                  <p class="card-text"><strong>Type: {{rig.type}}</strong></p>
                  <p class="card-text"><strong>Area: {{rig.locations[0].area}}</strong></p>
                  <div class="row justify-content-center">
                    <a href="rigs/{{rig.imo}}" class="btn btn-primary mr-2">Show details</a>
                  </div>
                </div>
              </div>
            </agm-info-window>

          </agm-marker>
        </agm-marker-cluster>
      </agm-map>
    </div>
  </div>
</div>

<div class="container-fluid" *ngIf="!rigs">
  <img src="https://i.imgur.com/KMaAB8Q.gif" class="center mt-3" style="height: 100px; width: 250px;" alt="Loading">
</div>
